version: '3.9'
services:
  redis_test:
    extends:
      file: ../../docker-compose.yaml
      service: redis
    container_name: redis_test
    ports:
      - "${REDIS_PORT}:6379"

  fastapi_test:
    extends:
      file: ../../docker-compose.yaml
      service: redis
    container_name: fastapi_test
    env_file:
      - ../../.env
    environment:
      - REDIS_HOST=127.0.0.1
      - ELASTIC_HOST=127.0.0.1
    ports:
      - "${SERVER_PORT}:8000"
    depends_on:
      - redis_test
      - elastic_test

  elastic_test:
    image: elasticsearch:7.14.2
    container_name: elastic_test
    ports:
      - "${ELASTIC_PORT}:9200"
    environment:
      - discovery.type=single-node

  tests:
    build: .
    container_name: tests
    depends_on:
      - redis_test
      - elastic_test
      - fastapi_test


networks:
  movies-network:
    name: movies-network
